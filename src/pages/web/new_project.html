<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Project - Floorplan Processor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="dialog">
            <header>
                <h1>Create New Project</h1>
            </header>

            <main>
                <!-- Project Information Section -->
                <section class="section">
                    <div class="section-header">
                        <h2>Project Information</h2>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="projectName">Project Name:</label>
                            <input type="text" id="projectName" class="form-control" placeholder="Enter project name">
                        </div>

                        <div class="form-group">
                            <label for="projectsDir">Projects Directory:</label>
                            <div class="input-group">
                                <input type="text" id="projectsDir" class="form-control" readonly>
                                <button type="button" class="btn btn-secondary" id="browseDirBtn">Browse...</button>
                            </div>
                            <div class="status-message" id="projectsDirStatus"></div>
                        </div>

                        <div class="form-group">
                            <label>Project will be created at:</label>
                            <div class="preview-path" id="projectPath"></div>
                            <div class="status-message" id="projectStatus"></div>
                        </div>
                    </div>
                </section>

                <!-- Data Source Section -->
                <section class="section">
                    <div class="section-header">
                        <h2>Data Source</h2>
                    </div>
                    <div class="section-content">
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="dataSource" value="csv" checked>
                                <span>Create from CSV file</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="dataSource" value="json">
                                <span>Import existing JSON files</span>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- CSV File Selection Section -->
                <section class="section" id="csvSection">
                    <div class="section-header">
                        <h2>Unit Data CSV File</h2>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" id="csvFilePath" class="form-control" readonly placeholder="No file selected">
                                <button type="button" class="btn btn-secondary" id="browseCsvBtn">Browse...</button>
                            </div>
                            <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                        </div>

                        <div class="info-box">
                            <p><strong>Select a CSV file containing unit data with one of the following formats:</strong></p>
                            
                            <div class="format-info">
                                <strong>Format 1 (Simple):</strong> Unit_ID, Unit_Type, MIRROR, Rotation (optional)
                                <ul>
                                    <li>Unit_ID (e.g., "B1-01-02", "bx-yyzz")</li>
                                    <li>Unit_Type (e.g., "a_s_3b_b1")</li>
                                    <li>MIRROR ("MIRROR", "TRUE", "FLIPPED" for flipped units, anything else for normal)</li>
                                    <li>Rotation (rotation angle in degrees, optional, defaults to 0)</li>
                                </ul>
                            </div>

                            <div class="format-info">
                                <strong>Format 2 (Original):</strong> Unit Name, Unit Type Dev Final, Mirrored, Rotation (optional)
                                <ul>
                                    <li>Unit Name (e.g., "B1-01-02", "bx-yyzz", or "FahidBeachResidences-B1-01-02")</li>
                                    <li>Unit Type Dev Final (e.g., "a_s_3b_b1")</li>
                                    <li>Mirrored ("true", "mirror", "flipped" for flipped units, "false", "normal" or anything else for normal)</li>
                                    <li>Rotation (rotation angle in degrees, optional, defaults to 0)</li>
                                </ul>
                            </div>

                            <div class="format-info">
                                <strong>Format 3 (New):</strong> UnitNumber, Mirror, Code
                                <ul>
                                    <li>UnitNumber (e.g., "TheBeachHouse-B6-04-03", "bx-yyzz")</li>
                                    <li>Mirror ("MIRROR" for flipped units, "NORMAL" for normal units)</li>
                                    <li>Code (e.g., "A_S_3BF_A1M" - will be sanitized to remove BF from 3rd segment)</li>
                                </ul>
                            </div>

                            <div class="format-info">
                                <strong>Format 4 (Unreal):</strong> UnitID, FormattedOutput, Rotation_Yaw
                                <ul>
                                    <li>UnitID (e.g., "B1-01-02", "bx-yyzz")</li>
                                    <li>FormattedOutput (e.g., "a_s_3b_BF_s1_0" where "BF" indicates mirrored)</li>
                                    <li>Rotation_Yaw (rotation angle, will be converted to closest cardinal: 0, 90, 180, 270)</li>
                                </ul>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="detectBalconies" checked>
                                <span>Detect balconies</span>
                                <span class="help-text">Automatically detect and create balcony variants</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="rotationOffset">Rotation Offset (degrees):</label>
                            <input type="number" id="rotationOffset" class="form-control" value="0" min="-360" max="360">
                            <span class="help-text">Global offset applied to all rotation values before cardinal conversion (for Unreal format)</span>
                        </div>
                    </div>
                </section>

                <!-- JSON Files Selection Section -->
                <section class="section" id="jsonSection" style="display: none;">
                    <div class="section-header">
                        <h2>Import JSON Files</h2>
                    </div>
                    <div class="section-content">
                        <div class="info-box">
                            <p>Select existing unit-reference.json and reference.json files to import:</p>
                            <ul>
                                <li><strong>unit-reference.json:</strong> Contains unit definitions with names, types, flip settings, and rotations</li>
                                <li><strong>reference.json:</strong> Contains type definitions with parent relationships and transformations</li>
                            </ul>
                            <p>These files will be copied to your new project directory.</p>
                        </div>

                        <div class="form-group">
                            <label>Unit Reference File:</label>
                            <div class="input-group">
                                <input type="text" id="unitRefFilePath" class="form-control" readonly placeholder="No file selected">
                                <button type="button" class="btn btn-secondary" id="browseUnitRefBtn">Browse...</button>
                            </div>
                            <input type="file" id="unitRefFileInput" accept=".json" style="display: none;">
                        </div>

                        <div class="form-group">
                            <label>Reference File:</label>
                            <div class="input-group">
                                <input type="text" id="refFilePath" class="form-control" readonly placeholder="No file selected">
                                <button type="button" class="btn btn-secondary" id="browseRefBtn">Browse...</button>
                            </div>
                            <input type="file" id="refFileInput" accept=".json" style="display: none;">
                        </div>
                    </div>
                </section>

                <!-- Preview Section -->
                <section class="section preview-section" id="csvPreviewSection">
                    <div class="section-header">
                        <h2>CSV Preview</h2>
                    </div>
                    <div class="section-content">
                        <div class="table-container">
                            <table id="csvPreviewTable">
                                <thead>
                                    <tr>
                                        <th>Unit Name</th>
                                        <th>Unit Type</th>
                                        <th>Mirrored</th>
                                        <th>Rotation</th>
                                    </tr>
                                </thead>
                                <tbody id="csvPreviewBody">
                                    <tr>
                                        <td colspan="4" class="no-data">No CSV file selected</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="status-message" id="csvStatus">No CSV file selected</div>
                    </div>
                </section>

                <section class="section preview-section" id="jsonPreviewSection" style="display: none;">
                    <div class="section-header">
                        <h2>JSON Preview</h2>
                    </div>
                    <div class="section-content">
                        <div class="table-container">
                            <table id="jsonPreviewTable">
                                <thead>
                                    <tr>
                                        <th>File</th>
                                        <th>Units/Types</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="jsonPreviewBody">
                                    <tr>
                                        <td colspan="3" class="no-data">No JSON files selected</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="status-message" id="jsonStatus">No JSON files selected</div>
                    </div>
                </section>
            </main>

            <footer>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="createBtn" disabled>Create Project</button>
                </div>
            </footer>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <script src="app.js"></script>
</body>
</html>

